import{_ as n,c as a,a as t,o as e}from"./app-CCFHk6b3.js";const l={};function d(i,s){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="composer" tabindex="-1"><a class="header-anchor" href="#composer"><span>Composer</span></a></h1><h2 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令"><span>常用命令</span></a></h2><table><thead><tr><th><strong>命令</strong></th><th><strong>用途</strong></th></tr></thead><tbody><tr><td>install</td><td>安装依赖（根据 lock）</td></tr><tr><td>update</td><td>更新依赖并写入 lock</td></tr><tr><td>require/remove</td><td>添加/移除依赖</td></tr><tr><td>dump-autoload</td><td>重建类映射表</td></tr><tr><td>show</td><td>查看依赖列表和详情</td></tr><tr><td>outdated</td><td>查看可更新包</td></tr><tr><td>validate</td><td>校验 composer.json</td></tr><tr><td>global</td><td>安装 CLI 工具到全局</td></tr></tbody></table><h3 id="常见参数" tabindex="-1"><a class="header-anchor" href="#常见参数"><span>常见参数</span></a></h3><table><thead><tr><th>参数</th><th>作用说明</th><th>使用场景示例</th></tr></thead><tbody><tr><td><code>--no-dev</code></td><td>不安装 <code>require-dev</code> 中的依赖</td><td><strong>生产环境部署</strong>，避免安装开发或测试用包</td></tr><tr><td><code>--prefer-dist</code></td><td>优先使用 <code>.zip</code> 或 <code>.tar</code> 包下载依赖，避免使用 Git 克隆</td><td><strong>构建/生产部署</strong>，下载更快、节省磁盘空间</td></tr><tr><td><code>--no-interaction</code></td><td>禁用交互提示，自动接受默认选项</td><td><strong>CI/CD、自动化部署脚本</strong> 使用</td></tr><tr><td><code>--optimize-autoloader</code>或<code>-o</code></td><td>生成优化的 classmap 自动加载器</td><td><strong>线上环境推荐</strong>，加快 PSR-4 加载速度</td></tr><tr><td><code>--classmap-authoritative</code></td><td>仅使用 classmap 加载器，不再扫描文件系统</td><td><strong>提升性能</strong>，适用于类文件固定不变的生产环境</td></tr><tr><td><code>--no-scripts</code></td><td>不执行 <code>composer.json</code> 中定义的 <code>scripts</code>（如 post-install）</td><td><strong>禁用自动化脚本</strong>，用于 CI/CD 环境或避免副作用</td></tr><tr><td><code>--ignore-platform-reqs</code></td><td>忽略 PHP 版本、扩展、系统依赖等平台要求</td><td><strong>绕过环境限制</strong>，例如测试或在不兼容环境中临时执行</td></tr><tr><td><code>--dry-run</code></td><td>模拟执行安装流程，不实际写入文件或安装依赖</td><td><strong>预览变更/验证依赖</strong> 是否冲突，提前发现潜在问题</td></tr></tbody></table><h3 id="生产环境命令优化" tabindex="-1"><a class="header-anchor" href="#生产环境命令优化"><span>生产环境命令优化</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">## 安装</span></span>
<span class="line"><span class="token function">composer</span> <span class="token function">install</span> --no-dev --prefer-dist --no-interaction --optimize-autoloader --classmap-authoritative</span>
<span class="line"><span class="token comment">## 重建类映射表</span></span>
<span class="line"><span class="token function">composer</span> dump-autoload <span class="token parameter variable">-o</span> --classmap-authoritative</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动加载" tabindex="-1"><a class="header-anchor" href="#自动加载"><span>自动加载</span></a></h2><h3 id="配置解析" tabindex="-1"><a class="header-anchor" href="#配置解析"><span>配置解析</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token comment">//composer.json配置示例</span></span>
<span class="line"><span class="token property">&quot;autoload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;psr-4&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;App\\\\&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app/&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;classmap&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;database/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;app/Legacy/&quot;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;app/Support/helpers.php&quot;</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>类型</th><th>格式</th><th>解释</th></tr></thead><tbody><tr><td>psr-4</td><td>&quot;App\\&quot;: &quot;app/&quot;</td><td>最常用，类名和目录结构一致</td></tr><tr><td>classmap</td><td>&quot;classmap&quot;: [&quot;database/&quot;]</td><td>自动扫描所有 PHP 文件生成映射</td></tr><tr><td>files</td><td>&quot;files&quot;: [&quot;app/helpers.php&quot;]</td><td>立即执行文件，通常用于函数定义，如助手函数</td></tr></tbody></table><h3 id="主要文件" tabindex="-1"><a class="header-anchor" href="#主要文件"><span>主要文件</span></a></h3><table><thead><tr><th><strong>文件名</strong></th><th><strong>作用</strong></th></tr></thead><tbody><tr><td>autoload.php</td><td>入口文件，负责加载其他所有加载器</td></tr><tr><td>autoload_psr4.php</td><td>PSR-4 加载规则映射（数组）</td></tr><tr><td>autoload_classmap.php</td><td>classmap 映射（类名到文件路径）</td></tr><tr><td>autoload_files.php</td><td>需要自动引入的文件（files）</td></tr><tr><td>autoload_static.php</td><td>优化模式下的静态映射文件（配合 -o 参数）</td></tr></tbody></table><h3 id="加载顺序与逻辑" tabindex="-1"><a class="header-anchor" href="#加载顺序与逻辑"><span>加载顺序与逻辑</span></a></h3><ol><li>先看 classmap（autoload_classmap.php）有没有这个类。</li><li>没找到，就去看 PSR-4 映射（autoload_psr4.php），拼接路径并扫描目录。</li><li>如果 --optimize-autoloader 被启用，则 autoload_static.php 会替代前面两个文件，以单文件数组查找提升性能，但是保留fallback</li><li>如果 --classmap-authoritative 启用，则仅使用 static/classmap 进行查找，并禁用fallback</li></ol><h2 id="依赖冲突与解决方式" tabindex="-1"><a class="header-anchor" href="#依赖冲突与解决方式"><span>依赖冲突与解决方式</span></a></h2><h3 id="常见冲突" tabindex="-1"><a class="header-anchor" href="#常见冲突"><span>常见冲突</span></a></h3><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>✅ 版本冲突</td><td>两个依赖包依赖相同组件但版本不一致，如 A 依赖 <code>guzzle ^7.0</code>，B 依赖 <code>guzzle ^6.5</code></td></tr><tr><td>✅ PHP 扩展冲突</td><td>缺失必要扩展，如 <code>ext-json</code>、<code>ext-pdo</code>，或版本不兼容</td></tr><tr><td>✅ 平台 PHP 版本差异</td><td>项目要求 <code>php &gt;= 8.1</code>，但本地或生产环境为 7.4</td></tr><tr><td>✅ 稳定性策略不当</td><td>使用 <code>dev-master</code> 时未正确设置 <code>minimum-stability</code> 和 <code>prefer-stable</code></td></tr><tr><td>✅ 依赖链复杂</td><td>多层嵌套依赖，冲突源头难以快速定位</td></tr><tr><td>✅ 报错信息不清晰</td><td>Composer 报错信息难以直观定位问题</td></tr></tbody></table><h3 id="使用命令" tabindex="-1"><a class="header-anchor" href="#使用命令"><span>使用命令</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看指定包的依赖来源</span></span>
<span class="line"><span class="token function">composer</span> why 包名</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看为何无法安装某个版本</span></span>
<span class="line"><span class="token function">composer</span> why-not 包名 版本号</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查两个包是否存在互斥关系</span></span>
<span class="line"><span class="token function">composer</span> prohibits 包A 包B</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 预演更新操作（不实际变更）</span></span>
<span class="line"><span class="token function">composer</span> update --dry-run</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看当前依赖的完整树结构</span></span>
<span class="line"><span class="token function">composer</span> show <span class="token parameter variable">--tree</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取详细调试日志</span></span>
<span class="line"><span class="token function">composer</span> update <span class="token parameter variable">--verbose</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实践建议" tabindex="-1"><a class="header-anchor" href="#实践建议"><span>实践建议</span></a></h3><ul><li>✅ 避免使用 或 <code>dev-master</code>，推荐使用 <code>^</code> 或 <code>~</code> 控制精确版本范围</li><li>✅ 将 <code>composer.lock</code> 納入版本控制，确保依赖一致性</li><li>✅ 设置合理稳定性策略，允许开发版本依赖但优先使用稳定版本：</li></ul><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;minimum-stability&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;prefer-stable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>✅ 明确声明 PHP 扩展依赖，避免部署出错（特别是在 Docker 中）：</li></ul><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ext-json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ext-pdo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,25)]))}const p=n(l,[["render",d],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/composer/","title":"Composer","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"常用命令","slug":"常用命令","link":"#常用命令","children":[{"level":3,"title":"常见参数","slug":"常见参数","link":"#常见参数","children":[]},{"level":3,"title":"生产环境命令优化","slug":"生产环境命令优化","link":"#生产环境命令优化","children":[]}]},{"level":2,"title":"自动加载","slug":"自动加载","link":"#自动加载","children":[{"level":3,"title":"配置解析","slug":"配置解析","link":"#配置解析","children":[]},{"level":3,"title":"主要文件","slug":"主要文件","link":"#主要文件","children":[]},{"level":3,"title":"加载顺序与逻辑","slug":"加载顺序与逻辑","link":"#加载顺序与逻辑","children":[]}]},{"level":2,"title":"依赖冲突与解决方式","slug":"依赖冲突与解决方式","link":"#依赖冲突与解决方式","children":[{"level":3,"title":"常见冲突","slug":"常见冲突","link":"#常见冲突","children":[]},{"level":3,"title":"使用命令","slug":"使用命令","link":"#使用命令","children":[]},{"level":3,"title":"实践建议","slug":"实践建议","link":"#实践建议","children":[]}]}],"git":{"updatedTime":1753686216000,"contributors":[{"name":"keith","username":"keith","email":"1033610335@qq.com","commits":1,"url":"https://github.com/keith"}]},"filePathRelative":"composer/README.md"}');export{p as comp,r as data};
